# Fix for Hardcoded Chapter Titles

## Problem
The graph was always showing hardcoded chapter titles ("Orientation", "Build the Experience", "Launch + Iterate") instead of the actual chapter titles generated by FlowFramePlannerAgent (like "Overview of Distributed Training").

## Root Cause
The `convertFlowPlanToLegacyPlan` function in `useAIFlowBuilder.ts` was:
1. Ignoring the actual chapters from `plan.chapters`
2. Creating new chapters based on frame phases with hardcoded titles
3. Overwriting all the generated chapter data

## Solution Implemented

### File Modified
`/src/app/ai-frames/hooks/useAIFlowBuilder.ts` (lines 485-660)

### Changes Made

1. **Priority-based Chapter Usage**:
   - First check if `plan.chapters` exists and has data
   - If yes, use those chapters with their actual titles
   - If no, fall back to phase-based grouping (backwards compatibility)

2. **Field Mapping Improvements**:
   - Added `description` field to match ChapterNodeData interface
   - Maintained `goal` field for backwards compatibility
   - Added `frameIds` array for proper graph generation
   - Added `linkSequentially` field for connection behavior

3. **Frame ID Validation**:
   - Added validation logging for missing frame references
   - Maps frameIds to actual frames using a Map lookup
   - Warns when referenced frames are not found

### Code Structure

```typescript
const convertFlowPlanToLegacyPlan = (plan: FlowPlannerPlan): PlannerPlan => {
  // Priority 1: Use existing chapters if available
  if (plan.chapters && plan.chapters.length > 0) {
    // Use actual chapters with real titles
    return {
      chapters: plan.chapters.map(chapter => ({
        id: chapter.id,
        title: chapter.title,  // ✅ Actual title like "Overview of Distributed Training"
        description: chapter.description,
        goal: chapter.description,
        // ... other fields
      }))
    };
  }

  // Priority 2: Fall back to phase-based grouping
  // Only used if no chapters exist (backwards compatibility)
}
```

## Results

✅ **Before**: Graph showed "Orientation", "Build the Experience", "Launch + Iterate"
✅ **After**: Graph shows actual chapter titles like "Overview of Distributed Training"

## Testing

1. Run a new flow generation with custom topic
2. Check that chapter titles match what was generated
3. Verify no hardcoded titles appear
4. Confirm frames are properly grouped in chapters
5. Check console for any validation warnings about missing frame IDs

## Console Logging

Added console.log statements to track:
- When using generated chapters vs. fallback
- Warning when frame IDs don't match
- Chapter data being used

## Backwards Compatibility

The solution maintains backwards compatibility:
- Old plans without chapters still work (use phase-based grouping)
- All field mappings preserve existing functionality
- No breaking changes to the API